<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Gift Card Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 15px;
    }
    .preview {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Generate Gift Cards</h2>
    <select id="amount">
      <option value="">Select Amount</option>
      <option value="25">$25</option>
      <option value="50">$50</option>
      <option value="100">$100</option>
      <option value="250">$250</option>
      <option value="500">$500</option>
    </select>
    <input type="number" id="quantity" placeholder="How many gift cards?" min="1" />
    <input type="date" id="expiry" />
    <input type="file" id="imageInput" accept="image/*" />
    <button onclick="generateGiftCards()">Generate</button>

    <div class="preview" id="status"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-storage.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAe6sUwdJ292z-GKKLGjyOEmgjr4OiKR8w",
      authDomain: "truenrothbox.firebaseapp.com",
      projectId: "truenrothbox",
      storageBucket: "truenrothbox.firebasestorage.app",
      messagingSenderId: "103087965950",
      appId: "1:103087965950:web:cc552e40fc69a3d29047af"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    function generateCode(length = 8) {
      const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789';
      return Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    }

    async function generateGiftCards() {
      const amount = document.getElementById('amount').value;
      const quantity = parseInt(document.getElementById('quantity').value);
      const expiry = document.getElementById('expiry').value;
      const imageFile = document.getElementById('imageInput').files[0];
      const statusBox = document.getElementById('status');

      if (!amount || !quantity || !expiry || !imageFile) {
        alert("Fill all fields and select image");
        return;
      }

      // Upload image once
      const imageRef = storage.ref(`giftcards/${Date.now()}-${imageFile.name}`);
      const uploadTask = await imageRef.put(imageFile);
      const imageUrl = await uploadTask.ref.getDownloadURL();

      statusBox.innerHTML = "Generating gift cards...";

      const batch = db.batch();
      for (let i = 0; i < quantity; i++) {
        const code = generateCode();
        const ref = db.collection("giftcards").doc();
        batch.set(ref, {
          code,
          amount: parseFloat(amount),
          expiry,
          used: false,
          status: "ready",  // could be "ready", "purchased", "redeemed"
          imageUrl,
          createdAt: new Date().toISOString()
        });
      }

      await batch.commit();
      statusBox.innerHTML = `${quantity} gift cards generated successfully.`;
    }
  </script>
</body>
</html>
