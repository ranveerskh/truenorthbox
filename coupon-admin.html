<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Coupon Manager</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    h2, h3 { text-align: center; }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .inactive { background: #eee; color: #888; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Coupon Management</h2>
    <input type="text" id="code" placeholder="Coupon Code (e.g. SAVE20)">
    <input type="number" id="discount" placeholder="Discount Percentage">
    <input type="number" id="maxUses" placeholder="Max Uses">
    <button onclick="createCoupon()">Add Coupon</button>

    <h3>All Coupons</h3>
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Discount %</th>
          <th>Max Uses</th>
          <th>Used</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="couponList"></tbody>
    </table>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const couponsRef = collection(db, "coupons");

    async function createCoupon() {
      const code = document.getElementById("code").value.trim();
      const discount = parseFloat(document.getElementById("discount").value);
      const maxUses = parseInt(document.getElementById("maxUses").value);

      if (!code || !discount || !maxUses) {
        alert("Please fill in all fields.");
        return;
      }

      await addDoc(couponsRef, {
        code,
        discount,
        maxUses,
        used: 0,
        status: "active",
        createdAt: new Date()
      });

      document.getElementById("code").value = "";
      document.getElementById("discount").value = "";
      document.getElementById("maxUses").value = "";
      fetchCoupons();
    }

    async function fetchCoupons() {
      const snapshot = await getDocs(couponsRef);
      const list = document.getElementById("couponList");
      list.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const row = document.createElement("tr");
        if (data.status === "inactive") row.className = "inactive";

        row.innerHTML = `
          <td><input value="${data.code}" onchange="updateField('${docSnap.id}', 'code', this.value)"></td>
          <td><input type="number" value="${data.discount}" onchange="updateField('${docSnap.id}', 'discount', this.value)"></td>
          <td><input type="number" value="${data.maxUses}" onchange="updateField('${docSnap.id}', 'maxUses', this.value)"></td>
          <td>${data.used}</td>
          <td>
            <select onchange="updateField('${docSnap.id}', 'status', this.value)">
              <option value="active" ${data.status === "active" ? "selected" : ""}>Active</option>
              <option value="inactive" ${data.status === "inactive" ? "selected" : ""}>Inactive</option>
            </select>
          </td>
          <td>
            <button onclick="deleteCoupon('${docSnap.id}')">Delete</button>
          </td>
        `;
        list.appendChild(row);
      });
    }

    async function updateField(id, field, value) {
      const ref = doc(db, "coupons", id);
      const update = {};
      update[field] = field === "discount" || field === "maxUses" ? Number(value) : value;
      await updateDoc(ref, update);
      fetchCoupons();
    }

    async function deleteCoupon(id) {
      if (confirm("Delete this coupon?")) {
        await deleteDoc(doc(db, "coupons", id));
        fetchCoupons();
      }
    }

    fetchCoupons();
  </script>
</body>
</html>
